webpackJsonp([23],{"7EVb":function(e,t,a){"use strict";t.a={STATUS_IN_ACTIVE:1,STATUS_ACTIVE:2,STATUS_FROZEN:3}},MyuZ:function(e,t,a){"use strict";var o=a("pq6b"),i=a("Y/bv"),n=a("VU/8"),r=n(o.a,i.a,!1,null,null,null);t.a=r.exports},Q6kV:function(e,t,a){"use strict";function o(e){a("v88h")}Object.defineProperty(t,"__esModule",{value:!0});var i=a("aRNQ"),n=a("kVWz"),r=a("VU/8"),s=o,l=r(i.a,n.a,!1,s,null,null);t.default=l.exports},XhLK:function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,"body{background-color:#e1e1e1}.book-chapter-box{background-color:#fff;padding:0 20px 4px 0}.book-name{padding-left:20px;line-height:40px;background-color:#f7f7f7;display:inline-block;vertical-align:top;width:240px;font-size:14px}.book-name-btngroup{float:right;margin-right:17px;margin-top:8px}.book-name-edit-box{font-size:0;height:40px;background-color:#f7f7f7}.book-name-input-box{padding-left:20px;padding-top:10px;font-size:0}.curchapter-name{line-height:40px}.book-chapter-tree-box{width:320px;min-height:600px;padding-bottom:20px;display:inline-block;vertical-align:top;border-right:1px solid #e2e2e2}.book-chapter-tree{padding-left:20px}.book-chapter-editor{margin-left:20px;width:838px;display:inline-block;vertical-align:top}.CodeMirror{height:400px}.book-chapter-create{margin-left:20px}",""])},"Y/bv":function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"golang123-editor"},[e.isMounted?a("textarea",{ref:"textarea"}):e._e(),a("Modal",{attrs:{title:"上传图片"},on:{"on-ok":e.ok,"on-cancel":e.cancel},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[a("Upload",{attrs:{"on-success":e.onUploadCallback,name:"upFile",format:["jpg","jpeg","png","gif"],action:e.uploadURL}},[a("Button",{attrs:{type:"ghost",icon:"ios-cloud-upload-outline"}},[e._v("上传图片")])],1)],1),e.isFullscreen?a("div",{staticClass:"editor-fullScreen-save"},[a("Button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保  存")])],1):e._e()],1)},i=[],n={render:o,staticRenderFns:i};t.a=n},aRNQ:function(e,t,a){"use strict";var o=a("woOf"),i=a.n(o),n=a("//Fk"),r=a.n(n),s=a("V8bM"),l=a("MyuZ"),c=a("y8ae"),d=a("FhoZ"),p=a.n(d),h=a("kcnK");t.a={validate:function(e){return!!e.params.id},asyncData:function(e){return r.a.all([s.a.getBook({client:e.req,query:{f:"md"},params:{id:e.params.id}}),s.a.getBookChapters({client:e.req,params:{id:e.params.id}})]).then(function(t){var a=t[0].data.book;if(!a)return void e.error({statusCode:404,message:"Page not found"});for(var o=t[1].data.chapters||[],i=0;i<o.length;i++)o[i].expand=!0;var n=Object(h.a)(o,{titleKey:"name",dataKeys:["expand","content"]}),r=null,s="";return n&&n.length&&(r=n[0],s=r.content),{isEditBookName:!1,inputBookName:"",editChapterNameModalVisible:!1,tempChapterID:0,tempChapterName:"",isMounted:!1,user:e.user,book:a,content:s,curChapter:r,createChapterID:0,createChapterName:"",createChapterModalVisible:!1,treeData:n,buttonProps:{type:"ghost",size:"small"}}}).catch(function(t){console.log(t),e.error({statusCode:404,message:"Page not found"})})},mounted:function(){this.isMounted=!0},methods:{onEditChapterName:function(){var e=this;s.a.updateBookChapterName({body:{name:this.tempChapterName,id:this.tempChapterID}}).then(function(t){if(t.errNo===c.a.ERROR)e.$Message.error({duration:p.a.messageDuration,closable:!0,content:t.msg});else if(t.errNo===c.a.LOGIN_TIMEOUT)location.href="/signin?ref="+encodeURIComponent(location.href);else if(t.errNo===c.a.SUCCESS){var a=e.getNode(e.tempChapterID);a.title=e.tempChapterName,e.tempChapterID=0,e.tempChapterName="",e.editChapterNameModalVisible=!1,e.$Message.success({duration:p.a.messageDuration,closable:!0,content:"修改成功"})}}).catch(function(t){e.$Message.error({duration:p.a.messageDuration,closable:!0,content:t.message||t.msg})})},cancelEditChapterName:function(){this.tempChapterID=0,this.tempChapterName="",this.editChapterNameModalVisible=!1},onPublishBookClick:function(){var e=this;this.$Modal.confirm({title:"发布图书",content:"确定要发布图书?",onOk:function(){s.a.publishBook({params:{bookID:e.book.id}}).then(function(t){t.errNo===c.a.SUCCESS?e.$Message.success({duration:p.a.messageDuration,closable:!0,content:"发布成功"}):e.$Message.error({duration:p.a.messageDuration,closable:!0,content:t.msg})}).catch(function(t){t="内部错误",e.$Message.error({duration:p.a.messageDuration,closable:!0,content:t})})},onCancel:function(){}})},onEditBookNameClick:function(){this.isEditBookName=!0,this.inputBookName=this.book.name},cancelEditBookNameClick:function(){this.isEditBookName=!1},onEditBookName:function(){var e=this;if(!this.inputBookName)return void this.$Message.error({duration:p.a.messageDuration,closable:!0,content:"图书名称不能为空"});s.a.updateBookName({body:{id:this.book.id,name:this.inputBookName}}).then(function(t){t.errNo===c.a.ERROR?e.$Message.error({duration:p.a.messageDuration,closable:!0,content:t.msg}):t.errNo===c.a.LOGIN_TIMEOUT?location.href="/signin?ref="+encodeURIComponent(location.href):t.errNo===c.a.SUCCESS&&(e.$Message.success({duration:p.a.messageDuration,closable:!0,content:"修改成功"}),e.book.name=t.data.book.name,e.isEditBookName=!1)}).catch(function(t){e.$Message.error({duration:p.a.messageDuration,closable:!0,content:t.message||t.msg})})},onCreateChapterClick:function(){this.createChapterID=0,this.createChapterModalVisible=!0,this.createChapterName=""},cancelCreateChapter:function(){this.createChapterID=0,this.createChapterModalVisible=!1,this.createChapterName=""},getNode:function(e){for(var t=this.treeData.slice(0);t.length;){var a=t[0];if(a.id===e)return a;var o=a.children;o&&o.length>0&&(t=t.concat(o)),t.shift()}},onCreateChapter:function(){var e=this,t=e.createChapterID;s.a.createBookChapter({body:{name:this.createChapterName,bookID:this.book.id,parentID:t}}).then(function(a){if(a.errNo===c.a.ERROR)e.$Message.error({duration:p.a.messageDuration,closable:!0,content:a.msg});else if(a.errNo===c.a.LOGIN_TIMEOUT)location.href="/signin?ref="+encodeURIComponent(location.href);else if(a.errNo===c.a.SUCCESS){var o={title:a.data.chapter.name,expand:!0,content:"",id:a.data.chapter.id,children:[]};if(t){var i=e.getNode(t);i.children.push(o)}else e.treeData.push(o);e.createChapterModalVisible=!1,e.createChapterName="",e.createChapterID=0,e.selectChapter({id:a.data.chapter.id})}}).catch(function(t){e.$Message.error({duration:p.a.messageDuration,closable:!0,content:t.message||t.msg})})},onSaveChapterContent:function(){var e=this;s.a.saveBookChapterContent({body:{chapterID:this.curChapter.id,content:this.content}}).then(function(t){if(t.errNo===c.a.ERROR)e.$Message.error({duration:p.a.messageDuration,closable:!0,content:t.msg});else if(t.errNo===c.a.LOGIN_TIMEOUT)location.href="/signin?ref="+encodeURIComponent(location.href);else if(t.errNo===c.a.SUCCESS){var a=e.getNode(e.curChapter.id);a.content=e.content,e.$Message.success({duration:p.a.messageDuration,closable:!0,content:"保存成功"})}}).catch(function(t){e.$Message.error({duration:p.a.messageDuration,closable:!0,content:t.message||t.msg})})},onContentSave:function(){},onContentChange:function(e){this.content=e},renderContent:function(e,t){var a=this,o=t.root,n=t.node,r=t.data,s=!(!n.children||!n.children.length);return e("span",{style:{display:"inline-block",width:"100%"}},[e("span",{style:{cursor:"pointer"},on:{click:this.selectChapter.bind(this,r)}},[e("Icon",{props:{type:s?"ios-folder-outline":"ios-paper-outline"},style:{marginRight:"8px"}}),e("span",{style:{color:this.curChapter&&r.id===this.curChapter.id?"#348eed":"#333"}},r.title)]),e("span",{style:{display:"inline-block",float:"right",marginRight:"32px"}},[e("Button",{props:i()({},this.buttonProps,{icon:"edit"}),style:{marginRight:"8px"},on:{click:this.showEditChapterNameModal.bind(this,r)}}),e("Button",{props:i()({},this.buttonProps,{icon:"android-add"}),style:{marginRight:"8px"},on:{click:this.append.bind(this,r)}}),e("Button",{props:i()({},this.buttonProps,{icon:"android-remove"}),on:{click:function(){a.remove(o,n,r)}}})])])},selectChapter:function(e){var t=this.getNode(e.id);this.curChapter=t,this.content=t.content},showEditChapterNameModal:function(e){this.tempChapterID=e.id,this.tempChapterName=e.title,this.editChapterNameModalVisible=!0},append:function(e){this.createChapterID=e.id||0,this.createChapterModalVisible=!0},remove:function(e,t,a){var o=this;this.$Modal.confirm({title:"删除章节",content:"确定要删除这个章节?",onOk:function(){s.a.deleteBookChapter({params:{chapterID:a.id}}).then(function(i){if(i.errNo===c.a.SUCCESS){o.$Message.success({duration:p.a.messageDuration,closable:!0,content:"已删除"}),o.curChapter&&o.curChapter.id===a.id&&(o.curChapter=o.treeData[0]);var n=e.find(function(e){return e===t}).parent;if(n){var r=e.find(function(e){return e.nodeKey===n}).node,s=r.children.indexOf(a);r.children.splice(s,1)}else for(var l=0;l<o.treeData.length;l++)if(o.treeData[l]===t.node){o.treeData.splice(l,1);break}}else o.$Message.error({duration:p.a.messageDuration,closable:!0,content:i.msg})}).catch(function(e){e="内部错误",o.$Message.error({duration:p.a.messageDuration,closable:!0,content:e})})},onCancel:function(){}})}},components:{"md-editor":l.a},head:function(){return{title:"编辑章节",link:[{rel:"stylesheet",href:"/styles/editor/simplemde.min.css"}]}},layout:"nosidebar",middleware:"userRequired"}},kVWz:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"book-chapter-box"},[a("div",[a("div",{staticClass:"book-chapter-tree-box"},[a("div",{staticClass:"book-name-edit-box"},[e.isEditBookName?a("div",{staticClass:"book-name-input-box"},[a("Input",{staticStyle:{width:"180px"},attrs:{value:e.book.name,placeholder:"请输入图书名称",size:"small"},model:{value:e.inputBookName,callback:function(t){e.inputBookName=t},expression:"inputBookName"}}),a("Button",{staticStyle:{float:"right","margin-right":"17px"},attrs:{type:"ghost",size:"small"},on:{click:e.cancelEditBookNameClick}},[e._v("取消")]),a("Button",{staticStyle:{float:"right","margin-right":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.onEditBookName}},[e._v("确定")])],1):a("div",[a("h1",{staticClass:"book-name"},[e._v(e._s(e.book.name))]),a("ButtonGroup",{staticClass:"book-name-btngroup",attrs:{shape:"circle"}},[a("Button",{attrs:{type:"primary",icon:"edit",size:"small"},on:{click:e.onEditBookNameClick}}),a("Button",{attrs:{type:"primary",icon:"android-upload",size:"small"},on:{click:e.onPublishBookClick}})],1)],1)]),a("div",{staticClass:"book-chapter-tree",style:{padding:e.treeData.length?"":"12px 0 12px 20px"}},[e.isMounted?a("Tree",{attrs:{data:e.treeData,render:e.renderContent,"empty-text":"暂无章节"}}):e._e()],1),a("div",{staticClass:"book-chapter-create"},[e.isMounted?a("Button",{attrs:{size:"large",type:"primary"},on:{click:e.onCreateChapterClick}},[e._v("创建章节")]):e._e()],1),a("Modal",{attrs:{title:e.createChapterID?"添加子章节":"创建章节"},on:{"on-cancel":e.cancelCreateChapter},model:{value:e.createChapterModalVisible,callback:function(t){e.createChapterModalVisible=t},expression:"createChapterModalVisible"}},[a("Input",{attrs:{placeholder:"章节名称",size:"large"},model:{value:e.createChapterName,callback:function(t){e.createChapterName=t},expression:"createChapterName"}}),a("Row",{staticStyle:{"margin-top":"14px"},attrs:{type:"flex",justify:"space-between"}},[a("Button",{staticStyle:{width:"48%"},attrs:{type:"ghost"},on:{click:e.cancelCreateChapter}},[e._v("取消")]),a("Button",{staticStyle:{width:"48%"},attrs:{type:"primary"},on:{click:e.onCreateChapter}},[e._v("确定")])],1),a("div",{attrs:{slot:"footer"},slot:"footer"})],1),a("Modal",{attrs:{title:"修改章节名称"},on:{"on-cancel":e.cancelEditChapterName},model:{value:e.editChapterNameModalVisible,callback:function(t){e.editChapterNameModalVisible=t},expression:"editChapterNameModalVisible"}},[a("Input",{attrs:{placeholder:"章节名称",size:"large"},model:{value:e.tempChapterName,callback:function(t){e.tempChapterName=t},expression:"tempChapterName"}}),a("Row",{staticStyle:{"margin-top":"14px"},attrs:{type:"flex",justify:"space-between"}},[a("Button",{staticStyle:{width:"48%"},attrs:{type:"ghost"},on:{click:e.cancelEditChapterName}},[e._v("取消")]),a("Button",{staticStyle:{width:"48%"},attrs:{type:"primary"},on:{click:e.onEditChapterName}},[e._v("确定")])],1),a("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1),a("div",{staticClass:"book-chapter-editor"},[a("h2",{staticClass:"curchapter-name"},[e._v("正在编辑: "+e._s(e.curChapter?e.curChapter.title:""))]),a("md-editor",{ref:"mdEditor",attrs:{value:e.content,user:e.user},on:{save:e.onContentSave,change:e.onContentChange}}),a("div",[e.isMounted?a("Button",{attrs:{size:"large",type:"primary"},on:{click:e.onSaveChapterContent}},[e._v("保存")]):e._e()],1)],1)])])},i=[],n={render:o,staticRenderFns:i};t.a=n},kcnK:function(e,t,a){"use strict";a.d(t,"a",function(){return o});var o=function(e,t){t=t||{titleKey:"title"};var a=e.slice(),o={id:0,title:"无",children:[]},i=[];for(i.push(o);i.length;){for(var n=i[0],r=a.length-1;r>=0;r--)if(a[r].parentID=a[r].parentID||0,a[r].parentID===n.id){var s={id:a[r].id,title:a[r][t.titleKey],children:[]};if(t.dataKeys)for(var l=0;l<t.dataKeys.length;l++){var c=t.dataKeys[l];s[c]=a[r][c],console.log(a[r].id,c,a[r][c])}i.push(s),n.children.push(s),a.splice(r,1)}i.splice(0,1)}return o.children}},pq6b:function(e,t,a){"use strict";var o=a("y8ae"),i=a("7EVb"),n=a("FhoZ"),r=a.n(n);t.a={props:{value:{type:String,required:!0},user:{type:Object}},data:function(){return{isMounted:!1,host:"",simplemde:null,SimpleMDE:null,uploadURL:r.a.uploadURL,modalVisible:!1,toolbar:null,isFullscreen:!1}},methods:{ok:function(){},cancel:function(){},showUpload:function(){if(this.user.status===i.a.STATUS_IN_ACTIVE)return void this.$Message.error({duration:r.a.messageDuration,closable:!0,content:"账号未激活，不能上传图片"});this.modalVisible=!0},onToggleFullScreen:function(e){e.toggleFullScreen(),this.isFullscreen=!this.isFullscreen},onSave:function(){this.$emit("save")},onUploadCallback:function(e,t){if(e)if(e.errNo===o.a.SUCCESS){var a=e.data.url;this.simplemde.setImageURL(a),this.SimpleMDE.drawImage(this.simplemde)}else e.errNo===o.a.IN_ACTIVE?(this.modalVisible=!1,this.$Message.error({duration:r.a.messageDuration,closable:!0,content:"账号未激活，不能上传图片"})):e.errNo===o.a.ERROR?(this.modalVisible=!1,this.$Message.error({duration:r.a.messageDuration,closable:!0,content:e.msg})):e.errNo===o.a.LOGIN_TIMEOUT&&(location.href="/signin")}},head:function(){return{script:[{src:"/javascripts/editor/simplemde.js"}]}},mounted:function(){this.isMounted=!0,this.$nextTick(function(){this.host=document.location.hostname;var e=window.SimpleMDE;this.toolbar=[{name:"bold",action:e.toggleBold,className:"fa fa-bold",title:"粗体"},{name:"italic",action:e.toggleItalic,className:"fa fa-italic",title:"斜体"},{name:"heading",action:e.toggleHeadingSmaller,className:"fa fa-header",title:"标题"},"|",{name:"unordered-list",action:e.toggleUnorderedList,className:"fa fa-list-ul",title:"无序列表"},{name:"ordered-list",action:e.toggleOrderedList,className:"fa fa-list-ol",title:"有序列表"},{name:"table",action:e.drawTable,className:"fa fa-table",title:"表格"},{name:"horizontal-rule",action:e.drawHorizontalRule,className:"fa fa-minus",title:"水平分隔线"},"|",{name:"code",action:e.toggleCodeBlock,className:"fa fa-code",title:"代码"},{name:"quote",action:e.toggleBlockquote,className:"fa fa-quote-left",title:"块引用"},{name:"link",action:e.drawLink,className:"fa fa-link",title:"链接"},{name:"image",action:this.showUpload,className:"fa fa-picture-o",title:"上传图片"},"|",{name:"preview",action:e.togglePreview,className:"fa fa-eye no-disable",title:"预览"},{name:"fullscreen",action:this.onToggleFullScreen,className:"fa fa-arrows-alt no-disable no-mobile",title:"全屏"}],this.SimpleMDE=e;var t=new e({element:this.$refs.textarea,promptURLs:!1,spellChecker:!1,toolbar:this.toolbar});this.simplemde=t;var a=e.prototype;a.getImageURL||(a.getImageURL=function(){return this.imageURL},a.setImageURL=function(e){this.imageURL=e});var o=this;this.simplemde.codemirror.on("change",function(){o.$emit("change",o.simplemde.value())}),this.simplemde.value(this.value)})},watch:{value:function(e,t){(e=e||"")!==this.simplemde.value()&&this.simplemde.value(e)}}}},v88h:function(e,t,a){var o=a("XhLK");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);a("rjj0")("43ffecf4",o,!0)},y8ae:function(e,t,a){"use strict";t.a={SUCCESS:0,ERROR:1,LOGIN_TIMEOUT:1001,IN_ACTIVE:1002}}});
//# sourceMappingURL=_id.77c6a1b7d0794038bfbe.js.map